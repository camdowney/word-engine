const a=e=>document.createRange().createContextualFragment(e),b=(e,t)=>e.dispatchEvent(new Event(t)),d=e=>console.error(`FernJS error #${e}: see url/${e} for more details.`),f=({r:e,...t})=>{let r={},n={},o={};Object.entries(t).forEach((([e,t])=>e.startsWith("__")?r[e.substring(2)]=t:e.startsWith("_")?n[e.substring(1)]=t:o[e]=t));const s=e||"div",i=Object.entries(o).filter((([e,t])=>void 0!==t)).map((([e,t])=>`${e.replaceAll("_","-")}="${t}"`)).join(""),c=a(`<${s} ${i}></${s}>`),d=([e,t])=>c.firstChild.addEventListener(e,t);return Object.entries(r).forEach((([e,t])=>{d(["mount",()=>window.addEventListener(e,t)]),d(["unmount",()=>window.removeEventListener(e,t)])})),Object.entries(n).forEach(d),c};let g=[],h=0,k=0;export const render=(e,t,r)=>{if(!e)return;const n="string"!=typeof e?e:document?.querySelector(e);if(void 0===t)return n.append(a(""));if("function"==typeof t)return d(0);if("object"!=typeof t)return n.append(a(t));if(Array.isArray(t))return t.forEach((e=>render(n,e)));const{r:o,...s}=t,i="function"==typeof o;i&&(k=0);const c=i?o({cid:"_"+h,...s}):t;if("object"!=typeof c||Array.isArray(c))return d(1);const{c:u,...l}=c;let p=null;if(r){const e=n.parentNode,t=[...e.children].indexOf(n);b(n,"unmount"),n.querySelectorAll("*").forEach((e=>b(e,"unmount"))),e.replaceChild(f(l),n),p=e.children[t]}else n.append(f(l)),p=n.lastChild;return i&&(g[h++]={e:p,props:t}),void 0!==u&&render(p,u),b(p,"mount"),p};let storage={};export const store=e=>{const t=h,r=`${t}-${k++}`;storage[r]||(storage[r]=e);return[storage[r],e=>{storage[r]="function"==typeof e?e(storage[r]):e;const{e:n,props:o}=g[t];h=t,render(n,o,!0),h=g.length}]};