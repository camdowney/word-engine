<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Word Engine</title>
  <meta name='description' content='Word Engine by Cameron Downey'>
  <link rel='stylesheet' href='./style.css'>
</head>
<body>
</body>
</html>

<script type='module'>
  import { render, store } from './min.js'
  import { isLetter, chunk } from './lib/util.js'
  import Board from './components/Board.js'
  import Suggestions from './components/Suggestions.js'
  import Counter from './components/Counter.js'

  const NUM_CELLS = 30

  render('body', () => {
    const [cells, setCells] = store([])

    const updateLetters = e => {
      const key = e.key.toLowerCase()

      if (key === 'backspace' && cells.length > 0)
        setCells(cells.slice(0, cells.length - 1))
      else if (!e.repeat && isLetter(key) && cells.length < NUM_CELLS)
        setCells([...cells, { letter: key, state: 0 }])
    }

    const updateCellState = e => {
      const index = e.srcElement.dataset.index
      
      if (!cells[index]) return
      setCells(c => (c[index].state = (c[index].state + 1) % 3) ? c : c)
    }

    // Will have to allow arbitrary number of args in array, infer their types and purposes
    // 1 arg: (component or children)
    // 2 args: (tag, component) (props or children)
    // 3 args: (tag, component) (props) (children)
    // tag: e.g. 'header' or 'section'
    // component: function reference
    // props: object with either element attributes or function arguments
    // children: either string, number, or array
    return ([
      ('header', {}),
      ('main', [
        ('section', { class: 'split', __keydown: updateLetters }, [
          (Board, { cells, updateCellState }),
          (Suggestions, { cells }),
          (Counter),
        ]),
      ]),
      ('footer', {}),
    ])
  })
</script>